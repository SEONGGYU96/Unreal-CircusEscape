# Unreal-CircusEscape

[기존 계획](https://github.com/SEONGGYU96/Unreal-CircusEscape/blob/main/InitalPlan.md)

## 결과 개요
- 테마 : 서커스장 탈출이었으나, 활용할 수 있는 에셋의 한계로 Low poly의 단순한 숲 테마로 제작하였습니다.
- 레벨 구성 : 총 2레벨
- 레벨 클리어 조건 : 목표지점에 도달
- 게임 오버 조건 : 캐릭터가 점프 중이 아닐 때, 90도 이상 기울어진 경우 게임 오버

## 역할
- 태승환(Github/ECtsh) : 스테이지 제작을 전담하였고 배경음악을 포함하여 레벨1, 레벨2를 구성하였습니다.
- 박경은(Github/pke0324) : HUD 제작을 전담하였습니다.
- 김성규(Github/SEONGGYU96) : 캐릭터 제작을 전담하였고, 캐릭터의 움직임을 개발하고 효과음과 애니메이션을 적용하였습니다.

## 구현

### 레벨 (스테이지)
- 담당 : 태승환(ECtsh)
- 유로 에셋을 구매하여 Low poly의 매력있는 스테이지를 꾸몄습니다.
- [스테이지 적용 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/4)
- Stage1
<img src="https://user-images.githubusercontent.com/57310034/102861092-68320080-4472-11eb-9661-8ad81862e375.png"/>

- Stage2
<img src="https://user-images.githubusercontent.com/57310034/102861556-34a3a600-4473-11eb-8630-9e4c986306b6.png"/>

- 회고
> 생각보다 테마에 맞는 에셋을 구하기 어려워 초기에 계획한 테마에 맞출 수 없었고 레벨 당 3~5분 소요에 맞추기 위해 난이도를 조절하는 것이 어려웠습니다. 최종적으로 2개의 레벨밖에 만들지 못한 것이 아쉽습니다. 하지만 다양한 환경요소와 액터들을 배치해보는 유익한 경험을 해볼 수 있었습니다.

### 캐릭터 (Kenny)
- 담당 : 김성규(SEONGGYU96)
- 무료 에셋을 활용하여 캐릭터와 애니메이션을 적용하였습니다.
- 방향키 (<--, -->)를 이용하여 캐릭터를 앞과 뒤로 기울이고, 스페이스바를 눌러 캐릭터가 기울인 방향으로 점프를 하도록 하였습니다. 만약 점프 중이 아닌데 90도 이상 과도하게 기울인 경우, `Ragdoll` 상태로 전환하고 조작할 수 없게 됩니다.
- [캐릭터 움직임 초기 구현 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/1)
    - 점프
    - <img src="https://user-images.githubusercontent.com/57310034/101975557-d4e21980-3c80-11eb-8030-ae519cfa5252.png">

        - `CharacterCompoent`에서 제공하는 점프로는 캐릭터가 기울인 방향으로 점프를 하도록 커스텀하는 방법을 찾지 못하였습니다. 따라서 `AddForce` 메서드를 활용하여 캐릭터의 업벡터 방향으로 물리적인 힘을 1회 적용하는 방법으로 점프시켰습니다.
    - 기울이기
    - <img src="https://user-images.githubusercontent.com/57310034/101975801-a82f0180-3c82-11eb-8424-0bbfbfdbbaed.png"/>

        - 기울이는 기능은 생각보다 무척 어려웠습니다. 바닥에서 기울일 경우, 캐릭터의 머리 부분에 캐릭터의 각도에 맞춰 힘을 지속적으로 가해줘야했습니다. 뿐만 아니라 캐릭터가 기울어진 정도와 기울이려는 방향을 고려하여 매번 다른 힘을 가해주어야 했습니다. 가령 이미 앞으로 기울어진 상태인데 앞으로 기울이려는 경우 순식간에 가속하여 넘어져버리고, 조금만 기울어져버리면 가속이 붙어 반대로 일어나는 것이 불가능했습니다. 이를 고려햐여 힘을 조절하는 것이 꽤 어려웠습니다.
        - 더불어, 공중에서는 중력과 무관하게 등속으로 회전하여야 했기 때문에 다른 메서드를 활용하여야 했습니다.
- [캐릭터 공중 회전 개선과 죽음 구현 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/2)
    - <img src="https://user-images.githubusercontent.com/57310034/102032716-e94b2100-3dfc-11eb-9701-6d0eb0497176.png"/>

        - 캐릭터의 업벡터를 정규화하여 x요소의 절대값이 0.9를 넘으면 82도 이상 기울어진 것이므로 죽은 것으로 처리하였습니다. 위와 같이 과도하게 기울었는지 확인하는 함수를 만들어 `Event Tic`에 연결해 `True`를 반환하는 순간 `Ragdoll`로 만들었습니다.  
- [캐릭터 애니메이션 적용 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/3)
    - <img src="https://user-images.githubusercontent.com/57310034/102097657-880d6700-3e69-11eb-8fa6-3a1bc7675941.png"/>

        - 캐릭터 메시와 함께 제공된 애니메이션을 적용하였습니다. Idle 상태에서는 방향키를 눌러 기울이려고 하는 방향으로 몸을 살짝 튕기는 애니메이션을 적용하였고 점프를 한 경우에도 방향키를 누르지 않으면 몸을 휘적거리는 애니메이션을, 방향키를 눌러 회전하면 몸에 힘을 주는 애니메이션을 적용하였습니다.
- [사운드 적용 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/5)
    - 점프를 할 때, 그리고 과도하게 기울여 죽을 때 상황에 맞는 사운드를 추가하였습니다. 캐릭터가 착지를 할 때에 발소리는 애니메이션에 기본적으로 포함이 되어 있었습니다.

- 회고
> `CharacterComponent`에서 제공하는 각종 편리한 메서드를 활용하지 못하고 `AddForce`로 raw한 구현을 한 탓에 블루프린트가 매끄럽지 못한 것이 아쉽습니다. 특히 `isInAir` 변수와 같이 점프 중인지 아닌지를 판단하는 변수를 초기화하려고 `Event Tic`에서 0.2초의 간격으로 계속 캐릭터의 발과 바닥이 충돌한 상태인지 검사하여 닿아있다면 `false`로 바꿔주는 방법을 사용하였습니다. 그리고 캐릭터의 방향 백터를 쪼개고 정규화하고 곱하는 등의 흐름이 너무 복잡해 진 것 같습니다. 그리고 초기 계획으로는 발 외에 어떠한 부분도 물체에 닿는다면 죽게 하려고 했으나 구현하지 못하였습니다. 그래도 캐릭터의 각종 물리적인 요소들을 활용하여 원하는 움직임을 만들어 낸 것이 상당히 즐거웠습니다.

## 게임 플레이
- 구현 : 김성규(SEONGGYU96)
- 캐릭터를 스테이지에 적용하고 클리어 시, 레벨의 이동과 게임 종료를 구현하였습니다.
- [레벨 전환 및 클리어 구현 PR](https://github.com/SEONGGYU96/Unreal-CircusEscape/pull/7)
- <img src="https://user-images.githubusercontent.com/57310034/102856733-66643f00-446a-11eb-982f-39c380bf74a6.png"/>  

    - `Goal_Blueprint` 클래스를 만들어 위와 같이 작성해주었습니다. 캐릭터가 `overlap` 되었을 때 현재 레벨의 이름을 이용해 검사하고, 다음 레벨로 넘어갈지 게임을 종료할지 결정합니다.

# 전체 회고
> 수업에서 배운 내용들을 활용하여 팀원들과 함께 계획한 게임을 직접 만들어봄으로써 언리얼 엔진에 더 자세히 이해할 수 있게 되었습니다. 게임을 개발할 때에는 물리지식이 상당히 많이 필요하다는 것 또한 알게 되었는데 이미 출시되어 있는 게임들이 사뭇 대단하게 느껴졌습니다. 아쉬운 점은 구글에 언리얼 관련 레퍼런스가 꽤 부족해서 원하는 기능을 구현하기가 무척 어려웠고 초기에 계획한 게임의 볼륨이 크지 않았음에도 개인 사정으로 인해 모두 구현하지 못한 것이 아쉬웠습니다.
